#!/bin/sh

#
# Work around bugs in mypy by filtering out false positive error messages.
#

set -e
set -u

tmp="$(mktemp -t mypy.XXXX)";

# Bugs filed:
# Callable has no attribute "todo": ... uh, not sure that's a bug, but ...
# Too many arguments for: https://github.com/python/mypy/issues/2088

mypy "$@"                                                                                             \
    | grep -v                                                                                         \
        -e ': note: ".*" defined here'                                                                \
        -e ': note: (Perhaps setting MYPYPATH .* would help)'                                         \
        -e ': note: (Stub files are from .*)'                                                         \
        > "${tmp}" || true;

sort < "${tmp}";

if grep -e ": error: " "${tmp}" > /dev/null; then
  exit 1;
fi;
